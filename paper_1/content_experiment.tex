\part{Измерение характеристик SiPM}
\section{Напряжение пробоя}
В качестве исследуемых детекторов были выбраны KETEK PM3325NP-SB0 Pin, KETEK PM1125NS-SB0 и Hamamatsu S10362-33-025C.
Наиболее важной характеристикой SiPM является напряжение пробоя.
Напряжение пробоя $V_{BD}$ - это напряжение, при котором коэффициент усиления равен нулю.

В различных работах было показано, что коэффициент усиления различных SiPM имеет линейную зависимость как от температуры,
так и от напряжения \cite{Silicon Photomultiplier's Gain Stabilization, Temperature and Bias Voltage Dependence, Characterization of SiPM: temperature dependencies, Characterisation of a silicon photomultiplier device}.
Таким образом, можно записать следующие выражения для коэффициента усиления $G(V, T)$:

\begin{eqnarray}\label{eq:G(V, T)}
G(V, T) = \frac{dG}{dV} \cdot \left( V - V_{BD}(T) \right) \\ \nonumber
G(V, T) = \frac{dG}{dT} \cdot T + G(T_0, V) \\ \nonumber
G(V, T) = a \cdot V + b \cdot T + c,
\end{eqnarray}
$$\text{где } a = \frac{dG}{dV}, b = \frac{dG}{dT}$$

Из уравнения (\ref{eq:G(V, T)}) легко найти напряжение пробоя, приравняв коэффициент усиления к нулю:
\begin{eqnarray}\label{eq:V_bd(T)}
V_{BD}(T) = \frac{-(b \cdot T + c)}{a} = \frac{dV}{dT} \cdot T + V_{0}
\end{eqnarray}

Для измерения напряжения пробоя и коэффициента усиления была собрана следующая установка (рис.~\ref{image:install_V_bd}).
Led Driver по световоду посылает короткую вспышку на SiPM, вырабатывая триггерный сигнал, идущий к АЦП CAEN dt5720a.
Сигнал с SiPM проходит через усилитель и поступает в АЦП CAEN dt5720a, который интегрирует сигнал при наличии триггерного сигнала.
Полученный зарядовый спектр в режиме on-line поступает на компьютер.
Температурная стабилизация обеспечивалась при помощи ПИД-регулятора ТРМ 101.
Он имеет следующую схему работы:???.
SiPM был установлен внутри металлической коробки. С одной из сторон размещен вентилятор, который необходим для отвода тепла с Пельтье элемента.
Часть вентилятора, расположенная внутри коробки, приклеена к медной пластине. С обратной стороны медной пластины расположен SiPM.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{install_V_bd}}
\caption{Схема измерения напряжения пробоя SiPM. Свет из LED Driver регистрируется SiPM, усиливается и оцифровывается DT5720a.
Температурная стабилизация обеспечивается ПИД-регулятором. Отклонение температуры от установленной не превышает 1К.}
\label{image:install_V_bd}
\end{figure}

Вычисление напряжения пробоя шло в несколько этапов.
Во-первых, сигнал интегрировался в воротах длиной 1 мкс (для KETEK PM3325NP-SB0 Pin) или 200 нс (для KETEK PM1125NS-SB0 и Hamamatsu S10362-33-025C).
Интенсивность Led driver менялась во время измерений, чтобы зарегистрировать максимально возможное число пиков.
В среднем записывались спектры с 10 - 12 пиками.
Поскольку при увеличении номера пика растет не только его среднее значение, но и дисперсия, то регистрация пиков с большими номерами не проводилась из-за большого времени накопления статистики.
В результате получился зарядовый спектр (рис.~\ref{image:sipm_spectrum}).
Затем окрестность каждого пика аппроксимировалась функцией гаусса и находилось среднее значение положения пика $Peak_{i}$ и ошибка определения среднего $\sigma_{Peak_{i}}$.
Причем пик с номером $0$ соответствует пику, располагающемуся вблизи нуля и возникает из-за интегрирования шумов.
Последующие пики вызваны регистрацией фотонов, излучаемых светодиодом, темновыми токами и кросстоком.
Однако среднее значение пика не зависит от причины срабатывания ячейки SiPM (если нет послеимпульсов).
В этой работе мы предпочли делать аппроксимацию в окрестности пика, в отличие других работ(например, \cite{Modeling crosstalk in silicon photomultipliers}), где среднее положение пика определялось путем аппроксимации всего зарядового спектра суммой гауссов.
Это связано с тем, что наличие послеимпульсов искажает форму пиков (она становится несимметричной) и, следовательно, вносит дополнительную ошибку в определение среднего значения пика.
Чтобы увеличить точность определения расстояния между соседними пиками величина $\Delta_{i}$,
имеющая точность определения $\sigma_{\Delta_j} = \sqrt{\sigma_{Peak_{i}}^2 + \sigma_{Peak_{i+1}} ^2}$, усреднялать:
$$\bar{\Delta} = \sum \limits_{i=1}^{N}    \frac{\Delta_{i} / (\sigma_{\Delta_i})^2 }        {   \sum \limits_{j=1}^{N} (\sigma_{\Delta_j})^2   } $$

Погрешность выставления напряжения $\Delta V$ оценивалась в 0.01 В.
Погрешность по температуре  $\Delta T$ оценивалась как минимальный шаг по температуре 1 К, деленный на $\sqrt{12}$.


Величина $\bar{\Delta}$ связана с коэффициентом усиления следующим образом:
$$G = \bar{\Delta} \cdot ADC_{\text{conversion rate}} / \text{charge of electron},$$
где $ADC_{\text{conversion rate}} [Кл  / (мВ \cdot с)] $ - коэффициент конверсии.
Для нахождения коэффициента конверсии меандр с амплитудой $V_{gen} = 1.602 В$ с генератора подавался на вход CAEN dt5720a через тестовый вход усилителя, нагруженный на емкость $C = 1 пФ$.
Оцифрованный сигнал при интегрировании давал заряд $Q [мВ \cdot с]$ и коэффициент конверсии вычислялся следующим образом:
$$
ADC_{\text{conversion rate}} = \frac{ C \cdot V_{gen} }{Q} = 4.33 \cdot 10^{-16} [Кл  / (мВ \cdot с)]
$$

Чтобы найти параметры $a$, $b$ и $c$, все измерения $G(V, T)$ аппроксимируются зависимостью (\ref{eq:G(V, T)}).
В итоге, восстановлены следующие параметры:

\begin{center}
\begin{tabular}{|p{3cm}|p{3cm}|p{3cm}|p{3cm}|p{3cm}|}
  \hline
  Параметр / Тип SiPM  &  KETEK PM3325NP-SB0 Pin &  KETEK PM1125NS-SB0 & Hamamatsu S10362-33-025C & Hamamatsu S10362-11-100C \\
  \hline
  $a$ [1/В] & $(1.974 \pm 0.045) \cdot 10^6$ & - & $(1.294 \pm 0.014) \cdot 10^5$ & $(2.957 \pm 0.019) \cdot 10^6$ \\
  \hline
  $b$ [1/К] & $(-1.245 \pm 0.201) \cdot 10^4$ & - &  $(-5.320 \pm 0.085) \cdot 10^3$ & $(-1.06 \pm 0.01) \cdot 10^5$ \\
  \hline
  $c$ & $(-4.150 \pm 0.103) \cdot 10^7$ & - & $ (-7.404 \pm 0.087) \cdot 10^6 $ & $ (-1.729 \pm 0.012) \cdot 10^8 $\\
  \hline
  \hline
  $\frac{dV}{dT}$ [мВ/К] & $ 6.3 \pm 1 $ & - & $ 41.1 \pm 0.8 $ & $ 35.8 \pm 0.4 $ \\
  \hline
  $V_{0}$[В] & $21.03 \pm 0.72$ & - & $57.2 \pm 0.9$ & $ 58.5 \pm 0.5 $ \\
  \hline
  $\chi^2 / Dof$ & 0.66 & - & 0.28 & 1.27\\
  \hline
\end{tabular}
\end{center}

\begin{figure}[h]
\center{\includegraphics[width=8cm]{sipm_spectrum}}
\caption{Спектр SiPM KETEK PM3325NP-SB0 Pin при напряжении 23.4 В и температуре 265 К при облучении светодиодом.
 Штриховыми линиями показано положение пиков. Время интегрирования 1 мкс. Напряжение на светодиоде менялось во время измерения, чтобы увеличить количество наблюдаемых пиков.}
\label{image:sipm_spectrum}
\end{figure}

\begin{figure}[h]
\center{\includegraphics[width=8cm]{VD_hamamatsu_3d_1}}
\caption{Коэффициент усиления $G(V, T)$ в зависимости от напряжения и температуры для Hamamatsu S10362-33-025C.}
\label{image:VD_hamamatsu_3d_1}
\end{figure}

\begin{figure}[h]
\center{\includegraphics[width=8cm]{VD_hamamatsu_3d_2}}
\caption{Коэффициент усиления $G(V, T)$ в зависимости от напряжения и температуры для Hamamatsu S10362-33-025C.}
\label{image:VD_hamamatsu_3d_2}
\end{figure}

Зависимость напряжения пробоя от температуры для KETEK PM3325NP-SB0 Pin изображена  на рис.~\ref{image:V_bd_KETEK}.
При температуре выше 275К вклад послеимпульсов становится значительным, поэтому при данном методе измерения напряжения пробоя ошибка увеличивается.
Как можно заметить, для данного типа SiPM практически отсутствует зависимость напряжения пробоя от температуры.

Зависимость напряжения пробоя от температуры для Hamamatsu S10362-33-025C изображена на рис.~\ref{image:V_bd_Hamamatsu}.
В интервале температур от 265К до 295К вклад послеимпульсов в интегрируемый заряд мал, поэтому ошибка измерения практически не меняется с температурой.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{V_bd_KETEK}}
\caption{Напряжение пробоя SiPM KETEK PM3325NP-SB0 Pin в зависимости от температуры. Время интегрирования 1 мкс.}
\label{image:V_bd_KETEK}
\end{figure}


\begin{figure}[h]
\center{\includegraphics[width=8cm]{V_bd_Hamamatsu}}
\caption{Напряжение пробоя Hamamatsu S10362-33-025C в зависимости от температуры. Время интегрирования 200 нс.}
\label{image:V_bd_Hamamatsu}
\end{figure}

\section{Нахождение формы сигнала}
\subsection{Фильтрация сигнала}
Чтобы правильно найти величину послеимпульсов, кросстоков и темновых токов, необходимо знать форму одноэлектронного сигнала.
Для анализа одноэлектронного сигнала были записаны данные с осцилографа (рис.~\ref{image:install_tektronix}).
Частота оцифровки осциллографа 5 ГГц.
В отличие от схемы с измерением напряжения пробоя, в этих измерениях светодиод не применяется.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{install_tektronix}}
\caption{Схема измерения формы одноэлектронного сигнала. Частота оцифровки осциллографа 5 ГГц.
Температурная стабилизация обеспечивается ПИД-регулятором. Отклонение температуры от установленной не превышает 1К.}
\label{image:install_tektronix}
\end{figure}

Поскольку каждый отдельный сигнал зашумлен, то для нахождения гладкой кривой применялось усреднение по большому числу событий (порядка 1000).
Сначала на компьютер записывался сигнал длиной 1 мс. Запуск производился единожды, после чего шла запись сигнала. Порог был на уровне шумов.
Далее вычислялась производная и выбирался порог, чтобы запуск шел именно от сигнала, а не от шумов.
Производная вычислялась при помощи фильтра Савицкого-Голея 3-го порядка с 51 точкой.

На рис.~\ref{image:hamamatsu_signal_295K_4_5OV} изображен сигнал с Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{hamamatsu_signal_295K_4_5OV}}
\caption{Сигнал с Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В.
Точками обозначена производная сигнала. Штриховой линией обозначен порог по производной.}
\label{image:hamamatsu_signal_295K_4_5OV}
\end{figure}

После запуска по производной в интервале от -500 нс до 500 нс считалось количество сигналов, превышавших порог.
Чтобы не считать один сигнал несколько раз, вводилось мертвое время 8 нс.
Если число сигналов в этом интервале было больше одного, то данный участок отбрасывался и брался следующий.
Это необходимо, чтобы сигнал был одиночным, т.е. был без примеси послеимпульсов.
Если же встречался один сигнал, то далее на всем интервале вычислялась максимальная (по модулю) амплитуда сигнала.
Спектр амплитуд (взят по модулю для удобства) для Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В представлен на рис.~\ref{image:hamamatsu_signal_295K_4_5OV_amp}.


\begin{figure}[h]
\center{\includegraphics[width=8cm]{hamamatsu_signal_295K_4_5OV_amp}}
\caption{Спектр амплитуд (по модулю) для Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В.
Штриховыми линиями показаны пороги для одноэлектронного импульса.}
\label{image:hamamatsu_signal_295K_4_5OV_amp}
\end{figure}

Для анализа отбирались лишь одноэлектронные импульсы.
На заключительном этапе производилось усреднение сигналов.
Усредненные сигналы для различных температур для Hamamatsu S10362-33-025C при перенапряжении 4.5В приведены на рис.~\ref{image:revo_time_vs_temp_ham_4_5_OV}.
Можно заметить небольшое увеличение времени восстановления ячейки при понижении температуры.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{revo_time_vs_temp_ham_4_5_OV}}
\caption{Форма сигнала для Hamamatsu S10362-33-025C при перенапряжении 4.5В и различных температурах.
Сигнал отфильтрован от послеимпульсов, усреднен и нормирован на единичную амплитуду.}
\label{image:revo_time_vs_temp_ham_4_5_OV}
\end{figure}

\begin{figure}[h]
\center{\includegraphics[width=8cm]{recovery_time-ketec_11_4_5OV}}
\caption{Форма сигнала для KETEK PM1125NS-SB0 при перенапряжении 4.5В и различных температурах.
Сигнал отфильтрован от послеимпульсов, усреднен и нормирован на единичную амплитуду.}
\label{image:recovery_time-ketec_11_4_5OV}
\end{figure}

\begin{figure}[h]
\center{\includegraphics[width=8cm]{recovery_time_ketec_11_265K}}
\caption{Форма сигнала для KETEK PM1125NS-SB0 при температуре 265К и различных значениях перенапряжения.
Сигнал отфильтрован от послеимпульсов, усреднен и нормирован на единичную амплитуду.}
\label{image:recovery_time-ketec_11_4_5OV}
\end{figure}

На рис.~\ref{} приведены формы одноэлектронных сигналов для Hamamatsu S10362-33-025C и KETEK PM1125NS-SB0.
\begin{figure}[h]
\center{\includegraphics[width=8cm]{recovery_time_hamamatsu_vs_ketek}}
\caption{Форма сигнала для KETEK PM1125NS-SB0 и Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В и для Hamamatsu S10362-11-100C при напряжении 70В и температуре 303К.
Сигнал отфильтрован от послеимпульсов, усреднен и нормирован на единичную амплитуду.}
\label{image:recovery_time_hamamatsu_vs_ketek}
\end{figure}

\subsection{Аппроксимация одноэлектронного сигнала}
Была проведена аппроксимация полученного сигнала следующей функцией:

\begin{eqnarray}\label{eq:V(t)}
V(t) = - A \cdot \exp \left[- \frac{t - t_0}{\tau_{rec}} \right] \cdot \left( 1 - \exp \left[ -\frac{t - t_0}{\tau_{rise}} \right] \right) \cdot \theta(t - t_0) + V_0,
\end{eqnarray}

где $A$ - амплитуда импульса, $t_0$ - задержка по времени, $\tau_{rec}$ - искомое время восстановления ячейки,
$\tau_{rise}$ - время нарастания переднего фронта, $V_0$ - напряжение в отсутствии сигнала, $\theta(t - t_0)$ - функция Хевисайда.
Параметр $V_0$ вычислялся как среднее значение на участке длиной 300 нс, предшествующем появлению переднего фронта, и фиксировался при аппроксимации.
Другие параметры имели ограничения по максимальному и минимальному значению, но в довольно широких пределах.

Однако форма сигнала (рис.\ref{image:revo_time_vs_temp_ham_4_5_OV}) имеет большое отклонение от зависимости (\ref{eq:V(t)}): $\chi^2 / Dof \approx 10$.
Это объясняется конечным временным разрешением системы, в результате чего на выходе системы сигнал будет представлять свертку исходного сигнала с откликом системы.
Если предположить, что отклики генератора, усилителя и осциллографа являются гауссовыми, то итоговое временное разрешение системы
можно представить как $\sigma = \sqrt{\sigma_{amp}^2 + \sigma_{oscil}^2}$.
В этом случае получим следующую форму сигнала:

\begin{eqnarray}\label{eq:V(t)_conv}
V(t) = V_0 - \frac{A}{2} \cdot \Bigg( \left\{ F(\sigma, \tau_{rec}^{fast}) - F(\sigma, \tau_{total}^{fast}) \right\} \Bigg)
\end{eqnarray}

$$
F(\sigma, \tau) = \exp\left[ \frac{\sigma^2 - 2 t \cdot \tau}{2 \tau^2 } \right] \cdot \left( 1 + Erf \left[ \frac{t - \sigma^2 / \tau}{ \sigma \sqrt{2} } \right] \right)
$$

$$
\tau_{total}^{fast} = \frac{\tau_{rec}^{fast} \cdot \tau_{rise}}{\tau_{rec}^{fast} + \tau_{rise}}
$$


Параметр $\sigma$ определялся следующим образом.
Тестовый сигнал (меандр) подавался с генератора на усилитель и измерялся осциллографом.
Далее сигнал аппроксимировался сверткой функции Хевисайда и гаусса:

\begin{eqnarray}\label{eq:V(t)_tektronix_generator}
V(t) = A \cdot \left(1 + erf\left[\frac{t}{\sqrt{\sigma_{gen}^2 + \sigma_{oscil}^2} \sqrt{2}}\right] \right) + V_{0}
\end{eqnarray}

Результат аппроксимации приведен на рис.~\ref{image:tektronix_generator}.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{tektronix_generator}}
\caption{Меандр с генератора, оцифрофанный осциллографом.
На рисунке изображен усредненный 512 раз передний фронт меандра, аппроксимированный функцией  (\ref{eq:V(t)_tektronix_generator}). $\sigma \approx 0.6 $ нс.}
\label{image:tektronix_generator}
\end{figure}

Для аппроксимации использовались лишь точки, находящиеся непосредственно на фронте сигнала.
Участок, следующий после фронта, искажен отражениями в длинной линии из-за неидеальной согласованности цепи.
Суммарная длина коаксиального кабеля около 1 метра, поэтому через 3 нс после начала импульса регистрируются отражения.
Улучшить согласование цепи сложно, т.к. все входные сопротивления уже нагружены на 50 Ом.
При измерениях было протестировано несколько нагрузочных сопротивлений и выбрано то, которое в лучшей степени уменьшает отражения.

Временное разрешение осциллографа предполагается значительно лучшим,
чем разрешение генератора, поэтому $\sqrt{\sigma_{gen}^2 + \sigma_{oscil}^2} \approx \sigma_{gen} \approx 0.6$ нс.

Далее сигнал с генератора подавался на тестовый вход усилителя, который соединен с конденсатором емкостью 1 пФ.
Эта цепь является дифференцирующей, поэтому на выходе усилителя сигнал будет не только свернут с откликом усилителя, но еще и продифференцирован (рис.~\ref{image:generator_amp_tektronix}).

\begin{figure}[h]
\center{\includegraphics[width=8cm]{generator_amp_tektronix}}
\caption{Сигнал с генератора, прошедший через тестовый вход усилителя и оцифрофанный осциллографом.
На рисунке изображен усредненный 512 раз сигнал. Пик аппроксимирован гауссовым распределением ($\sigma = 3$ нс).}
\label{image:generator_amp_tektronix}
\end{figure}

Основной пик аппроксимирован функцией гаусса и получено значение $\sigma = 3$ нс.
В данном случае отклик усилителя немного отличается от гауссового распределения.
Это связано с конечным быстродействием усилителя.
А сигнал, идущий после 17 нс, вызван неидеальной согласованностью цепи и отличием формы сигнала с генератора от прямоугольного.


\subsubsection{Быстрая и медленная компонента времени восстановления}

Более реалистичная модель формы сигнала должна учитывать также и медленную компоненту в сигнале \cite{Determination of the recovery time of silicon photomultipliers}.

\begin{eqnarray}\label{eq:V(t)_conv_slow}
V(t) = V_0 - \frac{A}{2} \cdot \Bigg( \left\{ F(\sigma, \tau_{rec}^{fast}) - F(\sigma, \tau_{total}^{fast}) \right\} + \\ \nonumber
\frac{R_{slow}}{R_{fast}} \cdot \left\{ F(\sigma, \tau_{rec}^{slow}) - F(\sigma, \tau_{total}^{slow}) \right\}  \Bigg)
\end{eqnarray}

В формуле (\ref{eq:V(t)_conv_slow}) параметр $R_{slow} / R_{fast}$ характеризует отношение доли медленной компоненты к быстрой компоненте времени восстановления.
Аппроксимация формы сигнала зависимостью (\ref{eq:V(t)_conv}) с быстрой и медленной компонентой имеет лучшее согласие, чем аппроксимация зависимостью только с быстрой компонентой.
Однако в модели с двумя компонентами присутствует больше параметров ($R_{slow}$, $\tau_{rec}^{slow}$) и, не смотря на меньшие значения $\chi^2$,
параметры получатся нефизическими и имеют широкий произвол в выборе, поэтому модель с наличием только быстрой компоненты оказалась предпочтительнее.

Но даже в этом случае нельзя сказать, что параметры определены верно, т.к. остается произвол в выборе параметров $\tau_{rec}$, $\tau_{rise}$  и $A$.
Детальное исследование времени восстановления в этой работе не приводится.
Однако аппроксимация моделью  позволяет (\ref{eq:V(t)_conv}) аналитически описывать сигнал и этого вполне достаточно для последующих измерений темновых токов, послеимпульсов и кросстоков.

Стоит отметить, что подавить послеимпульсы полностью не получится и они будут искажать форму сигнала, делая её отличной от (\ref{eq:V(t)_conv_slow}).
Алгоритм фильтрации послеимпульсов может эффективно подавить лишь те послеимпульсы, которые произошли через время порядка 10 нс после начала сигнала.
Если послеимпульс произошел раньше, то его амплитуда будет мала и алгоритм не сможет отличить послеимпульс от шума.

\begin{center}
\begin{tabular}{|p{3cm}|p{3cm}|p{3cm}|p{3cm}|p{3cm}|}
  \hline
  Параметр / Тип SiPM  &  KETEK PM3325NP-SB0 Pin &  KETEK PM1125NS-SB0 & Hamamatsu S10362-33-025C & Hamamatsu S10362-11-100C  \\
  \hline
  $\tau_{rec}^{fast} $ [нс] &  & 42 & 12 & 0.9 \\
  \hline
  $\tau_{rec}^{slow} $ [нс] &  & - & - & 41 \\
  \hline
  $\tau_{rise} $ [нс] &  & 3 & 28 & 1.5 \\
  \hline
  $\sigma$ [нс]&  & 1.1 & 1.4 & 0.6 \\
  \hline
  $R_{slow}$  & - & - & - & 0.24 \\
  \hline
  $\chi^2 / Dof$ & - & 5.5 & 0.26 & 9.2 \\
  \hline
\end{tabular}
\end{center}


Более детальное исследование времени восстановления приведено в работе \cite{Determination of the recovery time of silicon photomultipliers}.
Температурные зависимости времени восстановления ячейки приведены в \cite{Temperature and Bias Voltage Dependence}.

\section{Анализ сигнала}

Зная форму одноэлектронного сигнала, можно извлечь множество полезной информации о послеимпульсах, кросстоках и темновых токах.
Для этого производится разбор записанного файла, полученного ранее при нахождении формы сигнала, только с другими условиями.
Сигнал с SiMP можно представить как сумму одноэлектронных импульсов $Signal_{1e}(t - t_{i})$ со случайной амплитудой $A_{i}$ и временем возникновения $t_{i}$:

\begin{eqnarray}\label{eq:parsing}
V(t) = \sum \limits_{i = 0}^{N} A_{i} \cdot Signal_{1e}(t - t_{i}) + V_{0}
\end{eqnarray}

Форма одноэлектронного сигнала описывается выражением (\ref{eq:V(t)_conv}) и является известной функцией.
Задача заключается в нахождении параметров $A_{i}$, $t_{i}$, а также параметра $N$, который характеризует число перекрывающихся сигналов.
Если сигналы не перекрываются, то файл можно разделить на множество независимых частей,
каждая из которых будет описывать сигнал по формуле (\ref{eq:parsing}) при $N = 1$.

Также сигнал содержит случайный шум, который желательно подавить.
Однако спектр шума в значительно степени перекрывается со спектром исследуемого сигнала и шум возможно подавить лишь частично.
Для подавления шума был использован фильтр Савицкого-Голея третьего порядка и числом точек равным 51.
При малом количестве точек в окне фильтр малоэффективен, т.е. соотношение сигнал / шум практически не улучшается.
При большом количестве точек можно добиться существенного увеличения отношения сигнал / шум, однако это приведет к искажениям сигнала,
и, что более существенно, не позволит разделять близко расположенные импульсы.
Исходя из этих двух ограничений, количество точек было равным 51, что соответствует времени 10.2 нс.

Чтобы разделить записанный файл на множество независимых сигналов, используется следующий алгоритм: \\
1) Файл с данными читается в два массива: x и y. \\
2) Вычисляется первая и вторая производная при помощи фильтра Савицкого-Голея. \\
3) Запускается цикл, который пробегает последовательно все значения по индексу массива \\
4) Если производная и амплитуда оказываются ниже пороговых значений $th_{der}$ и $th_{amp}^{start}$, то время, предшествующее этому событию на 20 нс, берется как время старта сигнала.
Это условие необходимо для правильного вычисления базовой линии сигнала. \\
5) Если после предыдущего шага проходит более 5 нс и уровень сигнала выше порога по амплитуде $th_{amp}^{stop}$,
а также впереди на 20 нс производная не лежит ниже порога $th_{der}$, то данное время считается временем окончания сигнала.
Порог по амплитуде выбирается как пересечение сигнала с зашумленной базовой линией.
Условие на отсутствие в течение 20 нс нового сигнала позволяет правильно восстановить для последующего сигнала базовую линию.
Пороги по амплитуде, первой и второй производной выбирается фиксированными при данной температуре и перенапряжении.

В данном алгоритме нахождения сигналов важную роль играют пороги $th_{der}$ и $th_{amp}^{start}$.
Чтобы определить порог $th_{amp}^{start}$ построим график-лестницу при различных значениях мертвого времени $\tau_{amp}^{dead}$ рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1OV_amp_th}.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1OV_amp_th}}
\caption{Зависимость числа найденных сигналов от порога по амплитуде и мертвого времени $\tau_{amp}^{dead}$ для
Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C_295K_1OV_amp_th}
\end{figure}

Как можно заметить, график имеет структуру лестницы.
При пороге около 0.002 происходит первое резкое уменьшение числа отсчетов.
Это связано с тем, что порог превысил уровень шума.
Значение 0.002 и будет являться порогом $th_{amp}^{stop}$.
Следующий резкий скачок происходит при пороге около 0.04.
Это связано с тем, что порог превысил уровень одноэлектронного сигнала.
Порог для запуска по амплитуде $th_{amp}^{start}$ выбирается на уровне половины амплитуды одноэлектронного сигнала.
Таким образом, $th_{amp}^{start} = 0.02$.
Причем найденные пороги практически не зависят от выбора мертвого времени $\tau_{amp}^{dead}$.

Аналогичный график можно построить и для производной (рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1OV_der_th}).
\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1OV_der_th}}
\caption{Зависимость числа найденных сигналов от порога по производной и мертвого времени $\tau_{amp}^{dead}$ для
Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К. Отобраны лишь сигналы, превышающие порог $th_{amp}^{stop} = 0.002$}
\label{image:Hamamatsu_S10362-11-100C_295K_1OV_der_th}
\end{figure}

Этот график также имеет структуру лестницы.
При его построении отбирались лишь те сигналы, которые превышали амплитудный порог $th_{amp}^{stop} = 0.002$.
Это позволило увидеть лестничную структуру. Без использования условия на порог график был бы существенно искажен, т.к. шумы могут иметь производную,
значение которой сравнимо с производной сигнала.
Выше порога $-4 \cdot 10^{-4}$ вклад шумов значительно подавлен.
Это значение и выбирается в качестве $th_{der}$.


В результате работы данного алгоритма файл с данными разбивается на множество независимых участков.
На каждом участке может находиться как один импульс, так и большее количество.

Чтобы найти параметры $A_{i}$ и $t_{i}$, данный участок необходимо аппроксимировать функцией (\ref{eq:parsing}).
Поскольку данная функция внутренне нелинейна по параметру $t_{i}$, то необходимо задать начальные параметры времени начала сигнала.
Для этого используется следующий алгоритм:\\
1) Запускается цикл, начало и конец которого определяются временами старта и окончания участка сигнала, которые были получены ранее. \\
2) Если первая производная лежит ниже порога, то на участке, начиная с этого момента и заканчивая временем, большим на 5 нс,
ищется минимум производной. Время, при котором первая производная достигла минимума, далее будет использовано в качестве стартового значения параметра $t_{i}$. \\
3) Если первая производная превысила пороговое значение и прошло более 5 нс, то разрешается поиск следующего превышения порога.\\
Примечание: правильнее использовать минимум второй производной в качестве времени старта сигнала.
Однако использование минимума первой производной оказывается достаточно для правильного нахождения времени старта.

Далее алгоритм применялся для нахождения параметров Hamamatsu S10362-11-100C.
Данный SiMP имеет размер пикселя 100 мкм, что позволяет получать лучшее соотношении сигнал / шум, чем для SiPM с 25 микронным пикселем.
Также этот SiPM имеет короткое время нарастания фронта около 1нс, что позволит лучше разделять импульсы, чем при анализе сигнала с других SiPM.

В результате анализа сигнала с Hamamatsu S10362-11-100C при температуре 303K и напряжении 70В и различных порогах $(\chi^2 / Dof)_{th}$  были получены спектры временных интервалов (рис.~\ref{image:Hamamatsu_S10362-11-100C_303K_70V_dt_example}).

\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_303K_70V_dt_example}}
\caption{Распределение временных интервалов для Hamamatsu S10362-11-100C. Напряжение 70В, температура 303К.
На временах меньше 100 нс наблюдается искажение спектра из-за некорректной работы алгоритма.}
\label{image:Hamamatsu_S10362-11-100C_303K_70V_dt_example}
\end{figure}

На временах меньше 100 нс наблюдается искажение спектра из-за некорректности работы алгоритма.
Это связано с тем, что при завышенном пороге по $\chi^2 / Dof$ алгоритм обработки не продолжает увеличивать количество сигналов
 в аппроксимируемой функции (параметр $N$ в формуле (\ref{eq:parsing})) и останавливается.
То есть, например, вместо двух сигналов алгоритм найдет один и остановится.
Это приведет к меньшей доли коротких временных интервалов.

В другом предельном случае при использовании заниженного порога по $\chi^2 / Dof$ алгоритм найдет правильное количество сигналов, но не остановится и
будет увеличивать параметр $N$. Если $N$ достигло наибольшего числа доступных для аппроксимации функций (в наше случае их пять), то алгоритм остановится и
сигнал будет будет аппроксимирован этим количеством сигналов. Также алгоритм может остановиться раньше, если условие на $\chi^2 / Dof$ оказалось выполненным.
В любом случае при завышенном пороге по $\chi^2 / Dof$ появится аномальное увеличение коротких временных интервалов.

Чтобы избежать искажения спектра временных интервалов из-за подобных неоднозначностей применяется более продвинутый алгоритм.
Для начала рассмотрим корреляцию между амплитудой, полученной при аппроксимации сигнала однокомпонентной функцией ($N = 1$), и полученным значением $\chi^2 / Dof$ (рис.~\ref{image:Hamamatsu_S10362-11-100C_303K_70V_Chi2_amp 1}). Можно заметить несколько четко выделяющихся кластеров: $A_{1}$, $B_{1}$, $C_{1}$ и т.д.
Кластер $A_{1}$ соответствует одноэлектронным сигналам.
Кластеры $B_{1}$, $C_{1}$ и т.д. соответствуют событиям, когда одновременно сработали две, три и большее количество ячеек одновременно,
причем эти сигналы расположены далеко от других сигналов. Из-за этого они имеют низкое значение $\chi^2 / Dof$ при аппроксимации однокомпонентной функцией.
Остальные события со значением $\chi^2 / Dof > 4$ (будем обозначать множеством $Z_{1}$ ) соответствуют нескольким сигналам, расположенным на относительно небольшом расстоянии расстоянии друг от друга.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_303K_70V_Chi2_amp_1}}
\caption{Корреляция амплитуда - $\chi^2 / Dof$ при аппроксимации всех найденных сигналов однокомпонентной функцией.
Сигнал получен с Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C_303K_70V_Chi2_amp 1}
\end{figure}

Далее аппроксимируем события из множества $Z_{1}$ двухкомпонентной функцией.
В том случае каждое событие будет характеризоваться четырьмя параметрами: $\chi^2 / Dof $, $amp_{1}$, $amp_{2}$ - амплитуды первого и второго сигнала, $\Delta t$ - расстояние между сигналами.
Для начала построим корреляцию между суммарной амплитудой $amp_{1} + amp_{2}$ и значением $\chi^2 / Dof $ (рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1_OV_Chi2_amp1_amp2}).


\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1_OV_Chi2_amp1_amp2}}
\caption{Корреляция амплитуда - $\chi^2 / Dof$ при аппроксимации множества $Z_{1}$ (см. рис.~\ref{image:Hamamatsu_S10362-11-100C_303K_70V_Chi2_amp 1}) двухкомпонентной функцией.
Сигнал получен с Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C_295K_1_OV_Chi2_amp1_amp2}
\end{figure}

В этом случае также можно выделить несколько характерных множеств.
Рассмотрим корреляции расстояния между сигналами и суммарной амплитудой.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1_OV_amp1_amp2_dt_A2}}
\caption{Корреляция расстояния между сигналами и суммарной амплитудой при аппроксимации множества $A_{2}$ (см. рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1_OV_Chi2_amp1_amp2}) двухкомпонентной функцией.
Сигнал получен с Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C_295K_1_OV_amp1_amp2_dt_A2}
\end{figure}

Множество $A_{2}$ составляют сигналы, которые условно разделяются на два множества: $\alpha_{1}$ и  $\beta_{1}$.
Множество $\alpha_{1}$ соответствует двум близкорасположенным сигналам, причем их суммарная амплитуда вдвое больше амплитуды одноэлектронного импульса.
Это означает, что эти сигналы пришли с разных ячеек и являются темновыми сигналами.
В тоже время сигналы из множества $\beta_{1}$ имеют амплитуду, зависящую от расстояния между сигналами.
Это означает, что первый имел был одноэлектронным, а последующий оказался послеимпульсом.

Аналогичную корреляцию можно построить и для множества $B_{2}$ (рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1_OV_amp1_amp2_dt_B2}).

\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1_OV_amp1_amp2_dt_B2}}
\caption{Корреляция расстояния между сигналами и суммарной амплитудой при аппроксимации множества $B_{2}$ (см. рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1_OV_Chi2_amp1_amp2}) двухкомпонентной функцией.
Сигнал получен с Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C_295K_1_OV_amp1_amp2_dt_B2}
\end{figure}

В этом случае в множеству $\alpha_{2}$ будут принадлежать два близкорасположенных сигнала один их которых имеет одноэлектронную амплитуду,
а другой двойную амплитуду, т.е. вызванный одновременным срабатыванием двух ячеек из-за кросстока.
Множество $\beta_{2}$ содержит сигналы, которые можно разделить на две группы.
Первая группа образована сигналами, в которых вначале одновременно сработали две ячейки, а потом одна из ячеек дала послеимпульс.
Вторая группа образована сигналами, в которых вначале сработала одна ячейка, затем через некоторое время произошел послеимпульс, который вызвал кроссток.

Множества, аналогичные $A_{2}$ и $B_{2}$ с большой суммарной амплитудой соответствуют событиям, когда одновременно сработали большее количество ячеек.

События, попадающие в множества $A_{1}$ и $A_{2}$, соответствуют сигналам без кросстока.
Если исследовать события, в которых присутствует более двух сигналов, то получим аналогичные множества $A_{3}$, $A_{4}$ и т.д.
Однако большая часть событий (95\%) описывается одно и двухкомпонентными сигналами, поэтому события с большим количеством сигналов можно не рассматривать.

Далее построим спектр временных интервалов.
При его построении нужно учитывать лишь сигналы без кросстоков, чтобы потом аппроксимировать спектр функцией (\ref{eq:dt_probability_fast_slow}).
Это означает, что мы рассматриваем только те события, которые попали в множества $A_{1}$ или $A_{2}$ (множествами  $A_{3}$, $A_{4}$ и т.д. можно пренебречь).
Алгоритм нахождения временных интервалов следующий:
Запускается цикл, перебирающий поочередно все сигналы в хронологическом порядке. \\
1) При нахождении первого сигнала возможен один из трех вариантов. \\
Если первый найденный сигнал $\in A_{1}$, то никаких действий не производится и начинается шаг 2). \\
Если первый найденный сигнал $\in A_{2}$, то в гистограмму записывается расстояние между сигналами и начинается шаг 2). \\
Если первый найденный сигнал $\in \overline{ A_{1} \cup A_{2} }$, то рассматривается следующий сигнал и шаг 1) повторяется. \\
2) При нахождении последующих сигналов также возможен один из несколько вариантов.\\
Если последующий сигнал $\in A_{1}$ и предыдущий сигнал $\in A_{1} \cup A_{2}$, то в гистограмму записывается временной интервал между временем начала сигнала и предыдущим сохраненным временем. \\
Если последующий сигнал $\in A_{1}$ и предыдущий сигнал $\in \overline{A_{1} \cup A_{2}}$, то в гистограмму ничего не записывается.\\
Если последующий сигнал $\in A_{2}$ и предыдущий сигнал $\in A_{1} \cup A_{2}$, то в гистограмму записывается временной интервал между временем начала первого сигнала и предыдущим сохраненным временем,
а также временной интервал между первым и вторым сигналом.\\
Если последующий сигнал $\in A_{2}$ и предыдущий сигнал $\in \overline{ A_{1} \cup A_{2} }$, то в гистограмму записывается временной интервал между первым и вторым сигналом.\\
Далее шаг 2) повторяется, пока не будет рассмотрены все оставшиеся сигналы.

В результате получим спектр временных интервалов, изображенный на рис.~\ref{image:Hamamatsu_S10362-11-100C_295K_1_OV_dt_spectrum}.
При аппроксимации спектра функцией (\ref{eq:dt_probability_fast_slow}) найдем параметры $p_{s}$, $p_f$, $\nu_{s}$, $\nu_{f}$, $\nu_{DC}$.
Для аппроксимации используется небинированный фит и пакет RooFit.


\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1_OV_dt_spectrum}}
\caption{Спектр временных интервалов, аппроксимированный функцией (\ref{eq:dt_probability_fast_slow}).
События с кросстоком не учитываются.
Сигнал получен с Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C_295K_1_OV_dt_spectrum}
\end{figure}


При времени около 25 нс наблюдается изменение монотонности спектра.
Это связано с тем, что если послеимпульс происходит в ячейке через промежуток времени меньше 25 после предыдущего импульса,
то его амплитуда будет мала и такой импульс нельзя будет отличить от шумов. Из-за этого импульс будет распознан как однокомпонентный и он не даст вклада в малые времена.
Это приведет к искажению спектра.
Для правильной аппроксимации необходимо принимать во внимание только временные интервалы, больше некоторого порогового времени (около 25 нс.)
Чтобы уточнить это время была проведена аппроксимация при различных пороговых значениях.
На рис.~\ref{image:Hamamatsu_S10362-11-100C 295K_1_OV_dt_spectrum_timecut} приведена зависимость обратного параметра $1 / \nu_{f}$ от временного порога.

\begin{figure}[h]
\center{\includegraphics[width=8cm]{Hamamatsu_S10362-11-100C_295K_1_OV_dt_spectrum_timecut}}
\caption{Сигнал получен с Hamamatsu S10362-11-100C при перенапряжении 1В и температуре 295К.}
\label{image:Hamamatsu_S10362-11-100C 295K_1_OV_dt_spectrum_timecut}
\end{figure}

На участке от 25 до 30 нс значение параметра меняется мало.
Аналогичная зависимость наблюдается и для других параметров.
Таким образом, оптимальный временной порог находится от 25 до 30 нс.
В дальнейшем был выбран порог в 25 нс.



\section{Темновые токи}

Частота темновых токов пропорциональна плотности свободных носителей, которая выражается следующей формулой \cite{Characterization of SiPM: temperature dependencies}:

\begin{eqnarray}\label{eq:Hz_vs_temperature}
n(T) = A \cdot T^{3/2} \cdot \exp\left[ - \frac{E_g}{2 k_B \cdot T} \right],
\end{eqnarray}
где A - константа, зависящая от материала и технологических параметров, T - абсолютная температура, $E_g$ - ширина запрещенной зоны, $k_B$ - константа Больцмана.

Зависимость частоты от температуры была аппроксимирована функцией (\ref{eq:Hz_vs_temperature}). $\chi^2 / DoF < 1$, поэтому выбранная зависимость хорошо описывает данные.


\begin{eqnarray}\label{eq:Hz_vs_overvoltage}
\nu(\Delta V, T = const) = B \cdot \exp[k_{\Delta V} \cdot \Delta V]
\end{eqnarray}

В других работах наблюдали как линейный рост частоты темновых токов от перенапряжения при фиксированной температуре
 \cite{Characterization and Simulation of the Response} и  \cite{After-pulsingandcross-talkinmulti-pixelphotoncounters}  , так и экспоненциальный \cite{Temperature and Bias Voltage Dependence}.

Зависимость частоты одновременно и от перенапряжения и от температуры можно записать следующим образом:

\begin{eqnarray}\label{eq:Hz_vs_overvoltage_temperature}
\nu(\Delta V, T) = C \cdot T^{3/2} \cdot \exp\left[ - \frac{E_g}{2 k_B \cdot T} + k_{\Delta V} \cdot \Delta V \right]
\end{eqnarray}

Константа $C$ не зависит ни от перенапряжения, ни от температуры.
Для того, чтобы найти значения $C, E_g, k_{\Delta V}$, все измерения частоты от температуры и перенапряжения были аппроксимированы функцией (\ref{eq:Hz_vs_overvoltage_temperature}).
В результате были восстановлены следующие значения:

$$ C = (1.76 \pm 0.41) \cdot 10^8 [Гц] $$
$$ E_g = 0.75 \pm 0.01 [эВ] $$
$$ k_{\Delta V} =  0.426 \pm 0.012 [1/В] $$



\section{Кросстоки}

Существует несколько схожих вариантов измерения кросстока.
Первый заключается в использовании графика-лестницы.
При построении зависимости частоты появления сигналов от порога на графике можно наблюдать несколько участков,
на которых частота практически не зависит порога. Первое плато соответствует частоте темновых токов, которая обозначается $\nu_{0.5 p.e.}$.
Следующие наблюдаемые плато будут обусловлены наличием кросстоков. Частота второго плато обозначается $\nu_{1.5 p.e.}$, третьего - $\nu_{2.5 p.e.}$ и т.д.
Вероятность кросстока можно найти как отношение двух частот: $P_{X-talk} =  \nu_{1.5 p.e.} / \nu_{0.5 p.e.}$
Однако в нашем случае разрешение по амплитуде оказывается недостаточным, чтобы различить другие плато, кроме первого, поэтому данный метод не сработает.

Второй подход заключается в интегрировании сигнала за определенное время.
Если построить спектр накопленного заряда, то можно будет увидеть множество пиков.
Первый пик с центром в нуле - пьедестал, обусловленный интегрированием шумов.
Второй пик обусловлен одноэлектронным импульсом. Последующие пики возникают из-за наличия кросстоков.
Число событий в пиках обозначим $N_{i p.e}$, где i - номер пика, равный 1 для одноэлектронного.
Если найти отношение числа событий в пиках, вызванных кросстоком, к полному числу зарегистрированных полезных (не шумовых) событий,
то мы получим вероятность кросстока:

$$
P_{X-talk} = N_{i > 1 p.e} / ( N_{i > 1 p.e} + N_{1 p.e})
$$

Преимущество этого подхода заключается в хорошем разрешении по заряду, позволявшему четко разделять пики.
Недостаток же заключается во вкладе послеимпульсов в заряд, что приводит к искажению зарядового спектра и неоднозначному нахождению числа событий в одноэлектронном пике.

Третий, и наиболее правильный вариант измерений заключается в отбрасывании тех событий, которые содержат послеимпульсы.
Еще раз рассмотрим рис.~\ref{image:Hamamatsu_S10362-11-100C_303K_70V_Chi2_amp 1}.
Множество $A1$ описывает число одноэлектронных импульсов $N_{1 p.e}$.
Множество $A2$ описывает число импульсов $N_{2 p.e}$, когда одновременно сработало две ячейки.
На рис.~\ref{} приведена зависимость вероятности кросстока от перенапряжения.

\section{Послеимпульсы}



\section{Квантовая эффективность}
