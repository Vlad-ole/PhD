\part{Энергетическое разрешение детектора}

Одним из самых важных параметров детектора является энергетическое разрешение.
В этой главе мы найдем предельное энергетическое разрешение детектора и найдем основные факторы, препятствующие его улучшению.
\section{Детектор на основе ФЭУ и сцитиллятора}

Детектор на основе ФЭУ и сцинтиллятора - одни из самых простых детекторов, но в тоже время обладающий высоким энергетическим и временным разрешением.
Процесс распространения света в детекторе представлен на .
Сначала происходит поглощение рентгеновского фотона в толще сцинтиллятора.
Это приводит к появлению $N_{born}$ световых фотонов.
Распространяясь, свет может отражаться от стенок сцинтиллятора, поглощаться, преломляться и выходить наружу (в отсутствие отражателя) или же преломляться и проходить в оптическую смазку.
После оптической смазки свет падает на стекло ФЭУ и лишь после этого достигает фотокатода.
Достигнув фотокатода, часть света отразится от границы стекло-фотокатод.
Коэффициент отражения фотокатода обзначим $r_{cath}$.
Таким образом, лишь некоторая часть $N_{abs}$ фотонов поглотится в фотокатоде.
Фотокатод имеет некоторую конверсионную эффективность $Conv$.
Под конверсионной эффективностью понимается отношение среднего числа испущенных фотоэлектронов к среднего числу фотонов, поглощенных в толще фотокатода.
После прохождения фотокатода свет преобразуется в $N_{p.e.}^{init}$ фотоэлектронов.
Однако из-за неидеальности сбора фотоэлектронов (преимущественно на первый динод) лишь некоторая доля фотоэлектронов $N_{p.e.}$ сможет развить электронную лавину.
Неидеальность сбора фотоэлектронов описывается параметром $\eta$,
который характеризует отношение среднего числа зарегистрированных фотоэлектронов $E[N_{p.e.}]$ к среднему числу испущенных фотоэлектронов $N_{p.e.}^{init}$.
Далее при взаимодействии с динодами произойдет усиление и образуются $N_{e}$ электронов.

Величины $r_{cath}$, $Conv$, $\eta$ зависят от длины волны падающего света и характеризуют конкретный ФЭУ.
Однако на практике обычно измеряют производную от них величину - квантовую эффективность.
Для этого ФЭУ освещают нормальным пучком света и считают число зарегистрированных фотоэлектронов $E[N_{p.e.}]$.
Если известно число падающих фотонов $E[N_0]$, то квантовая эффективность определяется следующим образом: $\varepsilon = E[N_{p.e.}] / E[N_0]$.
При сборе света со сцинтиллятора угол падения света на фотокатод не будет нормальным, однако, как было показано в \cite{Optical properties of bialkali photocathodes},
 если угол падения не превышает $40^{\circ}$, то $r_{cath}$ остается практически константой,
 а $Conv$ и вовсе не зависит от угла падения света \cite{M.D. Lay}, поэтому в первом приближении можно описывать ФУЭ лишь одной характеристикой - квантовой эффективностью $\varepsilon$.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{detector}}
\caption{Детектор на основе ФЭУ и сцинтиллятора со схематичным представлением распространения фотонов и электронов.}
\label{ris:image}
\end{figure}

\subsection{ФЭУ без шумов}
Чтобы написать формулу для энергетического разрешения, рассмотрим подробно процесс формирования сигнала.
Основные используемые величины:

$N_{born}$  - число световых фотонов, родившихся в сцинтилляторе.

$N_{abs}$ - число световых фотонов, поглощенных в фотокатоде

$N_{p.e.}$ - число зарегистрированных фотоэлектронов

$N_{e}$ - число электронов, собранных на последнем аноде ФЭУ

Все эти величины связаны следующими соотношениями:

$$N_{abs} = \sum \limits_{i=0}^{N_{born}} n_{abs_{i}}$$

$$N_{p.e.} = \sum \limits_{i=0}^{N_{abs}} n_{p.e._{i}}$$

$$N_{e} = \sum \limits_{i=0}^{N_{p.e.}} G_{i}$$

$n_{abs}$ - число световых фотонов, поглощенных в фотокатоде, если в сцинтилляторе родился один световой фотон, $n_{abs} \in \{0, 1\}$.

$n_{p.e.}$ - число зарегистрированных фотоэлектронов, если в фотокатоде поглотился один световой фотон, $n_{p.e.} \in \{0, 1\}$.

$G$ - число электронов, собранных на ФЭУ, при условии, что регистрируется один фотоэлектрон

В процессе измерений мы регистрируем число электронов $N_{e}$. Энергетическое разрешение будет определяться следующим образом:
$$ \delta E = \Delta \cdot \frac{\sqrt{Var[N_{e}]}} {E[N_{e}]}, $$
где $\Delta = 2 \cdot \sqrt{2 \cdot \ln(2)} \approx 2.36$.
В дальнейшем более удобно будет использовать квадрат этой величины ${\delta E}^2$, деленный на $\Delta^2$.

Сцинтиллятор имеет некий спектр излучения с плотностью вероятности $P(\lambda)$, поэтому необходимо проинтегрировать сигнал и шум:
$$\delta E^2 / \Delta^2 = \frac{\int Var[N_e] \cdot P(\lambda)^2 d\lambda}{\left(\int E[N_e] \cdot P(\lambda) d\lambda \right)^2}$$

Рассмотрим для простоты случай, когда сцинтиллятор излучает свет на одной длине волны.

Чтобы посчитать мат. ожидание и дисперсию величины, представляющей собой сумму флуктуирующих величин, где число слагаемых тоже является случайной величиной, необходимо воспользоваться тождеством Вальда.
Данное тождество утверждает следующее:
$$ E \left[ \sum \limits_{i=0}^{N} X_{i} \right] = E[N] \cdot E[X] $$

Как следствие этого тождества получаем выражение для дисперсии:
$$ Var \left[ \sum \limits_{i=0}^{N} X_{i} \right] = Var[N] \cdot ( E[X] )^2 + Var[X] \cdot E[N]$$

Воспользовавшись этими двумя выражениями, выразим величину ${\delta E}^2 / \Delta^2$ через базовые величины $N_{born}$, $n_{abs}$, $n_{p.e.}$, $G$, которые описывают детектор:

\begin{eqnarray}\label{eq:ener_resol_base}
{\delta E}^2 / \Delta^2 = \frac{Var[N_{born}]}{(E[N_{born}])^2} + \frac{Var[n_{abs}]}{(E[n_{abs}])^2} \cdot \frac{1}{E[N_{born}]} + \\ \nonumber
 \frac{Var[n_{p.e.}]}{(E[n_{p.e.}])^2} \cdot \frac{1}{E[N_{abs}]} + \frac{Var[G]}{(E[G])^2} \cdot \frac{1}{E[N_{p.e.}]}
\end{eqnarray}

Рассмотрим каждое из слагаемых подробнее.

Слагаемое $\frac{Var[N_{born}]}{(E[N_{born}])^2}$ описывает вклад флуктуации числа фотонов, рожденных в сцинтилляторе.
 Стоит заметить, что $Var[N_{born}] \neq E[N_{born}] $, то есть пуассоновская статистика не выполняется.
 Детальное описание факторов, влияющих на собственное энергетическое разрешение сцинтиллятора можно найти в \cite{Qi_Li}.

Выражение $\frac{Var[n_{abs}]}{(E[n_{abs}])^2} \cdot \frac{1}{E[N_{born}]}$ описывает вклад флуктуаций сбора света на фотокатод.
Существует множество факторов, влияющих на величину флуктуации: разброс точки взаимодействия рентгеновского кванта и сцинтиллятора,
флуктуации поглощения световых фотонов в толще сцинтиллятора, оптической смазки или фотокатода и т.д.
Чтобы найти эту величину, необходимо смоделировать распространите света в сцинтилляторе.
Также тут присутствует фактор подавления $\frac{1}{E[N_{born}]}$: чем больше число рожденных фотонов, тем меньше светосбор влияет на энергетическое разрешение.

Следующее слагаемое $\frac{Var[n_{p.e.}]}{(E[n_{p.e.}])^2} \cdot \frac{1}{E[N_{abs}]}$ описывает флуктуации числа регистрируемых фотонов, вызванные конечной квантовой эффективностью ФЭУ.
Это слагаемое можно упростить до следующего вида: $\frac{1 - \varepsilon}{\varepsilon} \cdot \frac{1}{E[N_{abs}]}$.


Последнее слагаемое $\frac{Var[G]}{(E[G])^2} \cdot \frac{1}{E[N_{p.e.}]}$ описывает флуктуации усиления. Флуктуации усиления $\frac{\sqrt{Var[G]}}{E[G]}$ обычно не превышают $10-20\%$ \cite{Characterization and Simulation of the Response}, а наличие фактора подавления $E[N_{p.e.}]$ делает вклад данного слагаемого в энергетическое разрешение еще меньше.

Рассмотрим теперь вклад каждого слагаемого в энергетическое разрешение в зависимости от энергии регистрируемого гамма кванта.
Для примера возьмем сцинтиллятор LYSO:Ce и ФЭУ с квантовой эффективностью 28\%.
Данные о непропорциональности световыхода и собственное энергетическое разрешение сцинтиллятора LYSO:Ce взяты из \cite{Light output and energy resolution}.
Чтобы получить флуктуации светосбора $\frac{\sqrt{Var[n_{abs}]}}{E[n_{abs}]}$, в программе GEANT4 был смоделирован детектор, аналогичный тому, что представлен на рис.~\ref{ris:image}.
Флуктуации составили около 10\%.
Также из моделирования была получена величина $E[n_{abs}]$, варьирующаяся в зависимости от размера сцинтиллятора и материала отражателя от 0.2 до 0.6.
В дальнейшем будем считать для определенности, что $E[n_{abs}] = 0.5$. Флуктуации усиления $\frac{\sqrt{Var[G]}}{E[G]}$ примем за 10\%.
Таким образом, получим следующие зависимости факторов от энергии гамма-кванта (рис.~\ref{image:YAP_Ce_PMT_simple_case}).
На рис.~\ref{image:YAP_Ce_PMT_simple_case} не представлены вклады флуктуации светосбора и коэффициента усиления,
т.к. они пренебрежимо малы относительно собственного энергетического разрешения сцинтиллятора и флуктуаций, связанных с неэффективностью детектора.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{YAP_Ce_PMT_simple_case}}
\caption{Энергетическое разрешение детектора на основе YAP:Ce и ФЭУ с квантовой эффективностью 28\%. Светосбор равен 50\%.}
\label{image:YAP_Ce_PMT_simple_case}
\end{figure}

Итого, пренебрегая вкладами флуктуаций светосбора и усиления и пользуясь тем, что $E[n_{p.e.}] = \varepsilon$,
с достаточно хорошей точность можно использовать следующую формулу для вычисления энергетического разрешения:
\begin{eqnarray}\label{eq:ener_resol_base}
{\delta E}^2 / \Delta^2 \approx \frac{Var[N_{born}]}{(E[N_{born}])^2} + \frac{1 - \varepsilon}{N_{p.e.}}
\end{eqnarray}

\subsection{Учет собственных шумов ФЭУ и шумов электроники}
В предыдущем разделе описана самая простая формула для энергетического разрешения.
Однако, для полноты картины, следует учесть еще шум ФЭУ и шум электроники.

Отличие от предыдущего случая будет в том, что теперь в итоговый заряд будет давать вклад не только сигнал, но и шум. Чтобы выделить сигнал, необходимо вычесть шум из измерений:
$$N_e^{signal} = N_e^{signal + noise} - N_e^{noise}$$

При вычислении мат. ожидания вклад шумов сократится, а дисперсия сигнала будет зависеть от дисперсии шумов.
Шум может быть обусловлен темновыми токами ФЭУ $N_e^{DC}$ и шумом электроники $N_e^{electronics}$.
При работе с ФЭУ или SiPM усиление обычно достаточно велико и вкладом шума электроники можно пренебречь.
Таким образом, получим следующую формулу для вычисления энергетического разрешения:
$$\delta E = \Delta \cdot \frac{ \sqrt{ Var[N_e^{signal}] + 2 \cdot Var[N_e^{DC}] } }{E[N_e^{signal}]}$$

Если раньше предполагалось бесконечное время интегрирования сигнала, то теперь оно конечно.
Обозначим его $t_{gate}$. Предположим, что время интегрирования в несколько раз больше характерного времени затухания сигнала
и мы собираем практически весь заряд от сигнала, т.е. величина $N_e^{signal}$ не зависит от $t_{gate}$.
Число регистрируемых шумовых фотоэлектронов $N_{p.e.}^{DC}$ будет подчиняться статистике Пуассона с параметром, равным произведению времени интегрирования $t_{gate}$ на частоту шумовых импульсов $\nu_{DC}$.
В этом случае величина $N_e^{DC}$ будет вычисляться следующим образом:

$$ N_e^{DC} = \sum \limits_{i=0}^{N_{p.e.}^{DC}} G_{i}, $$

причем $E[N_{p.e.}^{DC}] = Var[N_{p.e.}^{DC}] = t_{gate} \cdot \nu_{DC}$.

Если расписать определения величин $Var[N_e^{signal}], Var[N_e^{DC}], E[N_e^{signal}]$ и привести подобные, то получим следующее выражение для энергетического разрешения:

\begin{eqnarray}\label{eq:ener_resol_total}
\delta E^2 / \Delta^2 = \frac{Var[N_{p.e.}] + 2 \cdot Var[N_{p.e.}^{DC}]}{\left( E[N_{p.e.}] \right)^2} +
\frac{Var[G]}{\left( E[G] \right)^2} \cdot \left( \frac{1}{E[N_{p.e.}]} + \frac{2}{E[N_{p.e.}^{DC}]} \right)
\end{eqnarray}

На рис.~\ref{image:ER_noise} изображена зависимость энергетического разрешения детектора на основе ФЭУ и сцинтиллятора YAP:Ce от величины темновых токов.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{ER_noise}}
\caption{Энергетическое разрешение детектора на основе YAP:Ce и ФЭУ с квантовой эффективностью 28\%.
 Светосбор равен 50\%. Различные графики соответствуют различным значениям зарегистрированных темновых токов.}
\label{image:ER_noise}
\end{figure}

Время высвечивания сцинтиллятора YAP:Ce составляет около 25 нс, а шумы ФЭУ при комнатной температуре не превышают 1 кГц, поэтому вклад темновых токов в энергетическое разрешение пренебрежимо мал.
Если рассмотреть в качестве детектора SiPM у которого шум при комнатной температуре около 1 МГц / 1 $мм^2$ и пренебречь кроссстоками и послеимпульсами,
то и в этом случае вклад в энергетическое разрешение шумов будет мал.

\section{Энергетическое разрешение SiPM}
С точки зрения энергетического разрешения SiPM отличается от ФЭУ наличием двух дополнительных факторов, влияющих на шум: послеимпульсами и кросстоками.

\subsection{Учет кросстоков}

Кроссток или оптический кроссток - это эффект срабатывания соседних ячеек SiPM из-за излучения оптических фотонов во время образования лавины в исходном пикселе.
Поскольку свет распространяется практически мгновенно, то данный эффект не приводит к каким-либо временным сдвигам. Чтобы учесть влияние кросстока на энергетическое разрешение,
необходимо модифицировать функцию плотности вероятности величины $n_{p.e.}$.
Если раньше данная величина имела распределение Бернулли с параметром $E[n_{p.e.}]$, то теперь распределение будет другим.
Чтобы найти это распределение нужно знать квантовую эффективность регистрации (или коэффициент конверсии,
т.к. все зависит от того, какую величину рассматривать в качестве базовой) и вероятность срабатывания соседней ячейки из-за кросстока.
Детальное описание вероятностей срабатывания ячеек из-за кросстока можно найти в \cite{Modeling crosstalk in silicon photomultipliers}.
В этой статье рассматриваются несколько моделей распространения фотонов, но утверждается, что для большинства моделей SiPM наиболее правдоподобной является модель 4-х соседей.
Вероятность срабатывания N ячеек выражается через параметр $p$, который описывает вероятность того, что соседний пиксель сработает из-за кросстока.
Вычислить параметр $p$ можно, зная полную вероятность кросстока $p_{total}$ (одно или больше кросстоковых событий): $(1 - p)^{4} = 1 - p_{total}$.
В дальнейшем удобно будет ввести величину $q = 1 - p$.
Таким образом, зная квантовую эффективность $\varepsilon$ и вероятность кросстока $p$, получим следующую плотность вероятности в модели 4-х соседей.


\begin{tabular}{|c|c|}
  \hline
  суммарное число сработавших ячеек& плотность вероятности $n_{p.e.}$ \\
  \hline

  \hline
  1 & $\varepsilon \cdot q^4$ \\
  \hline
  2 & $\varepsilon \cdot 4  p \cdot q^6$ \\
  \hline
  3 & $ \varepsilon \cdot 18  p^2 \cdot q^8$ \\
  \hline
  4 & $\varepsilon \cdot 4  p^3 \cdot q^8 [1 + 3q + 18 q^2]$ \\
  \hline
  5 & $\varepsilon \cdot 5  p^4 \cdot q^{10} [8 + 24q + 55q^2]$ \\
  \hline
  $N > 5$ & $\simeq\varepsilon \cdot P(5) \left[ 1 - \frac{P(5)}{1 - \sum \limits_{k=1}^{4} P(k) } \right]^{N - 5}$ \\
  \hline

\end{tabular}

На Рис.~\ref{x-talk:image} показана зависимость среднего числа регистрируемых ячеек в зависимости от величины кросстока.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{x-talk}}
\caption{Зависимость среднего числа регистрируемых ячеек в зависимости от величины кросстока.}
\label{x-talk:image}
\end{figure}


Чтобы учесть вклад кросстоков в энергетическое разрешение необходимо пересчитать $E[n_{p.e}]$ и $Var[n_{p.e.}]$ с учетом модифицированной плотности вероятности.


Если учесть еще и собственные шумы SiPM при наличии кросстока, то необходимо изменить величину $N_{p.e.}^{DC}$:
\begin{eqnarray}
N_{p.e.}^{DC} = \sum \limits_{i=0}^{N^{DC}} n_{p.e._{i}}^{DC}, \nonumber
\end{eqnarray}

где величина $n_{p.e.}^{DC}$ - число зарегистрированных фотоэлектронов, если произошел одиночный шумовой (тепловой) импульс.
Данная величина имеет тоже распределение,что и $n_{p.e.}$, только с параметром $\varepsilon = 1$.
Величина $N^{DC}$ имеет распределение Пуассона с параметром $t_{gate} \cdot \nu_{DC}$.
Таким образом, получим следующие значения для мат. ожидания и дисперсии:


$$E[N_{p.e.}] = E[n_{p.e.}] \cdot E[N_{abs}]  $$
$$E[N_{p.e.}^{DC}] = E[n_{p.e.}^{DC}] \cdot E[N^{DC}]  $$
$$ Var[N_{p.e.}] = Var[N_{abs}] \cdot \left( E[n_{p.e.}] \right)^2 + Var[n_{p.e.}] \cdot E[N_{abs}]  $$
$$Var[N_{p.e.}^{DC}] = Var[N^{DC}] \cdot \left( E[n_{p.e.}^{DC}] \right)^2 + Var[n_{p.e.}^{DC}] \cdot E[N^{DC}] $$

При учете кросстоков вид формулы для энергетического разрешения останется прежний (\ref{eq:ener_resol_total}).


На рис.~\ref{ER_x-talk:image} представлена зависимость энергетического разрешения от энергии фотона при различных значениях кросстока.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{ER_x-talk}}
\caption{Энергетическое разрешение детектора на основе YAP:Ce и SiPM с квантовой эффективностью 28\%.
Светосбор равен 50\%. Различные графики соответствуют различным значениям вероятности кросстока.
Темновые токи отсутствуют.}
\label{ER_x-talk:image}
\end{figure}

\subsection{Учет послеимпульсов}

Послеимпульс - сигнал, появляющийся через некоторый промежуток времени после основного сигнала.
Причина появления послеимпульсов заключается в захвате электронов в ловушки во время лавины с их последующим высвобождение через промежуток времени,
обычно длящийся от нескольких наносекунд до нескольких микросекунд \cite{Characterisation Studies of Silicon Photomultipliers}.
После срабатывания основного сигнала напряжение на ячейке будет восстанавливаться к исходному значению к течение времени восстановления ячейки, которое мы обозначим $\tau_{r}$.
Таким образом, если послеимпульс произошел после основного сигнала через время $\Delta t$,
то доля заряда в послеимпульсе относительно основного сигнала будет выражаться следующим образом: $\xi(\Delta t) = 1 - \exp \left( -\Delta t / \tau_{r} \right)$.
Плотность вероятности величины $\Delta t$ описывается двумя затухающими экспонентами \cite{After-pulsingandcross-talkinmulti-pixelphotoncounters}:
$$ f(\Delta t) = A_{s} \cdot \exp(-\Delta t / \tau_{s}) + A_{f} \cdot \exp(-\Delta t / \tau_{f}), $$
где $\tau_{s}$ и $\tau_{f}$ среднее время, проходящее между двумя импульсами для быстрой и медленной компоненты, а $A_{s}$ и $A_{f}$ - нормировочные константы.

В большинстве приложений время интегрирования $t_{gate}$ выбирают в несколько раз больше времени восстановления ячейки $\tau_{r}$.
Мы предположим что, $t_{gate}$ достаточно большое и в несколько раз превышает и $\tau_{f}$.
Также для простоты пренебрежем вкладом медленной компоненты послеимпульса, т.к. её вероятность намного меньше вероятности быстрой компоненты.


Чтобы учесть вклад послеимпульсов в энергетическое разрешение необходимо ввести поправку
 на число зарегистрированных электронов:
$$N_{e} = \sum \limits_{i=0}^{N_{p.e.}} (G_{i} + A_{i}) $$

Случайная величина $G$ имеет распределение Гаусса и описывает по-прежнему флуктуации усиления, а величина $A$ описывает послеимпульсы.
Мат. ожидание и дисперсия величины $G_{tot} = G + A$ находятся из эксперимента.

Итого, если учитывать послеимпульсы, то необходимо в формуле для энергетического разрешения заменить величину $G$ на $G_{tot}$.


\part{Измерение характеристик SiPM}
\section{Напряжение пробоя}
В качестве исследуемых детекторов были выбраны KETEK PM3325NP-SB0 Pin и Hamamatsu S10362-33-025C.
Наиболее важной характеристикой SiPM является напряжение пробоя.
Напряжение пробоя $V_{BD}$ - это напряжение, при котором коэффициент усиления равен нулю.

В различных работах было показано, что коэффициент усиления различных SiPM имеет линейную зависимость как от температуры,
так и от напряжения \cite{Silicon Photomultiplier's Gain Stabilization, Temperature and Bias Voltage Dependence, Characterization of SiPM: temperature dependencies, Characterisation of a silicon photomultiplier device}.
Таким образом, можно записать следующие выражения для коэффициента усиления $G(V, T)$:

\begin{eqnarray}\label{eq:G(V, T)}
G(V, T) = \frac{dG}{dV} \cdot \left( V - V_{BD}(T) \right) \\ \nonumber
G(V, T) = \frac{dG}{dT} \cdot T + G(T_0, V) \\ \nonumber
G(V, T) = a \cdot V + b \cdot T + c,
\end{eqnarray}
$$\text{где } a = \frac{dG}{dV}, b = \frac{dG}{dT}$$

Из уравнения (\ref{eq:G(V, T)}) легко найти напряжение пробоя, приравняв коэффициент усиления к нулю:
\begin{eqnarray}\label{eq:V_bd(T)}
V_{BD}(T) = \frac{-c - b \cdot T}{a}
\end{eqnarray}

Для измерения напряжения пробоя и коэффициента усиления была собрана следующая установка (рис.~\ref{image:install_V_bd}).
Led Driver по световоду посылает короткую вспышку на SiPM, вырабатывая триггерный сигнал, идущий к АЦП CAEN dt5720a.
Сигнал с SiPM проходит через усилитель и поступает в АЦП CAEN dt5720a, который интегрирует сигнал при наличии триггерного сигнала.
Полученный зарядовый спектр в режиме on-line поступает на компьютер.
Температурная стабилизация обеспечивалась при помощи ПИД-регулятора ТРМ 101.
Он имеет следующую схему работы:???.
SiPM был установлен внутри металлической коробки. С одной из сторон размещен вентилятор, который необходим для отвода тепла с Пельтье элемента.
Часть вентилятора, расположенная внутри коробки, приклеена к медной пластине. С обратной стороны медной пластины расположен SiPM.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{install_V_bd}}
\caption{Схема измерения напряжения пробоя SiPM. Свет из LED Driver регистрируется SiPM, усиливается и оцифровывается DT5720a.
Температурная стабилизация обеспечивается ПИД-регулятором. Отклонение температуры от установленной не превышает 1К.}
\label{image:install_V_bd}
\end{figure}

Вычисление напряжения пробоя шло в несколько этапов.
Во-первых, сигнал интегрировался в воротах длиной 1 мкс (для KETEK PM3325NP-SB0 Pin) или 200 нс (для KETEK PM3325NP-SB0 Pin).
Интенсивность Led driver менялась во время измерений, чтобы зарегистрировать максимально возможное число пиков.
В среднем записывались спектры с 10 - 12 пиками.
Поскольку при увеличении номера пика растет не только его среднее значение, но и дисперсия, то регистрация пиков с большими номерами не проводилась из-за большого времени накопления статистики.
В результате получился зарядовый спектр (рис.~\ref{image:sipm_spectrum}).
Затем окрестность каждого пика аппроксимировалась функцией гаусса и находилось среднее значение положения пика $Peak_{i}$ и ошибка определения среднего $\sigma_{Peak_{i}}$.
Причем пик с номером $0$ соответствует пику, располагающемуся вблизи нуля и возникает из-за интегрирования шумов.
Последующие пики вызваны регистрацией фотонов, излучаемых светодиодом, темновыми токами и кросстоком.
Однако среднее значение пика не зависит от причины срабатывания ячейки SiPM (если нет послеимпульсов).
В этой работе мы предпочли делать аппроксимацию в окрестности пика, в отличие других работ ???, где среднее положение пика определялось путем аппроксимации всего зарядового спектра суммой гауссов.
Это связано с тем, что наличие послеимпульсов искажает форму пиков (она становится несимметричной) и, следовательно, вносит дополнительную ошибку в определение среднего значения пика.
Величина $\Delta_{0} = Peak_{1} - Peak_{0}$ связана с коэффициентом усиления следующим образом: $G = \Delta_{0} \cdot ADC_{\text{conversion rate}} / \text{charge of electron}$,
где $ADC_{\text{conversion rate}} [мВ  / Кл] $ - коэффициент конверсии.
Чтобы увеличить точность определения коэффициента усиления, расстояния между соседними пиками $\Delta_{i}$,
имеющие точность определения $\sigma_{\Delta_j} = \sqrt{\sigma_{Peak_{i}}^2 + \sigma_{Peak_{i+1}} ^2}$, усреднялись:
$$\bar{\Delta} = \sum \limits_{i=1}^{N}    \frac{\Delta_{i} / (\sigma_{\Delta_i})^2 }        {   \sum \limits_{j=1}^{N} (\sigma_{\Delta_j})^2   } $$

Для наглядности зависимости $G(V, T = const)$ и $G(V = const, T)$ с линейной аппроксимацией приведены на рис.~ и рис.~ соответственно.
Чтобы найти параметры $a$, $b$ и $c$, все измерения $G(V, T)$ аппроксимируются зависимостью (\ref{eq:G(V, T)}).
В итоге, восстановлены следующие параметры:
$$ a = [1/В]$$
$$ b =  [1/К]$$
$$ c =  $$


\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{sipm_spectrum}}
\caption{Спектр SiPM KETEK PM3325NP-SB0 Pin при напряжении 23.4 В и температуре 265 К при облучении светодиодом.
 Штриховыми линиями показано положение пиков. Время интегрирования 1 мкс. Напряжение на светодиоде менялось во время измерения, чтобы увеличить количество наблюдаемых пиков.}
\label{image:sipm_spectrum}
\end{figure}

Зависимость напряжения пробоя от температуры для KETEK PM3325NP-SB0 Pin изображена  на рис.~\ref{image:V_bd_KETEK}.
При температуре выше 275К вклад послеимпульсов становится значительным, поэтому при данном методе измерения напряжения пробоя ошибка увеличивается.
Напряжение пробоя от температуры будет описываться следующей формулой:
$$V_{BD} = 7 [мВ/К] \cdot T[К] + 20 [В]$$
Как можно заметить, для данного типа SiPM практически отсутствует зависимость напряжения пробоя от температуры.


Зависимость напряжения пробоя от температуры для Hamamatsu S10362-33-025C изображена на рис.~\ref{image:V_bd_Hamamatsu}.
В интервале температур от 265К до 295К вклад послеимпульсов в интегрируемый заряд мал, поэтому ошибка измерения практически не меняется с температурой.
Напряжение пробоя от температуры будет описываться следующей формулой:
$$V_{BD} = 44 [мВ/К] \cdot T[К] + 56 [В]$$



\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{V_bd_KETEK}}
\caption{Напряжение пробоя SiPM KETEK PM3325NP-SB0 Pin в зависимости от температуры. Время интегрирования 1 мкс.}
\label{image:V_bd_KETEK}
\end{figure}


\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{V_bd_Hamamatsu}}
\caption{Напряжение пробоя Hamamatsu S10362-33-025C в зависимости от температуры. Время интегрирования 200 нс.}
\label{image:V_bd_Hamamatsu}
\end{figure}

\section{Время восстановления ячейки и форма сигнала}
Чтобы правильно найти величину послеимпульсов, кросстоков и темновых токов, необходимо знать форму одноэлектронного сигнала.
Для анализа одноэлектронного сигнала были записаны данные с осцилографа (рис.~\ref{image:install_tektronix}).
Частота оцифровки осциллографа 5 ГГц.
В отличие от схемы с измерением напряжения пробоя, в этих измерениях светодиод не применяется. 

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{install_tektronix}}
\caption{Схема измерения формы одноэлектронного сигнала. Частота оцифровки осциллографа 5 ГГц.
Температурная стабилизация обеспечивается ПИД-регулятором. Отклонение температуры от установленной не превышает 1К.}
\label{image:install_tektronix}
\end{figure}

Поскольку каждый отдельный сигнал зашумлен, то для нахождения гладкой кривой применялось усреднение по большому числу событий (порядка 1000).
Сначала на компьютер записывался сигнал длиной 1 мс. Запуск производился единожды, после чего шла запись сигнала. Порог был на уровне шумов.
Далее вычислялась производная и выбирался порог, чтобы запуск шел именно от сигнала, а не от шумов.
Производная в точке i вычислялась как разница между точками i  и  i + 20:
$$
\frac{dV}{dt} = C \cdot (V(t_{i}) - V(t_{i - 20})),
\text{где } C \text{ - некоторая несущественная константа}
$$

Значение в 20 точек (т.е. $20 \cdot 0.2 нс = 4 нс$) выбрано из соображения, что передний фронт сигнала имеет время нарастания около 8 нс, 
поэтому разница между точками будет иметь характерный пик на переднем фронте.
Если вычислять производную как разницу между соседними точками, то передний фронт будет практически неотличим от шумов.

Для различных значений перенапряжений и температур порог по производной был выбран одинаковым и составил -0.006 В (константа $C$ опущена).
На рис.~\ref{image:hamamatsu_signal_295K_4_5OV} изображен сигнал с Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{hamamatsu_signal_295K_4_5OV}}
\caption{Сигнал с Hamamatsu S10362-33-025C при температуре 295К и перенапряжении 4.5В.
Точками обозначена производная сигнала. Штриховой линией обозначен порог по производной.}
\label{image:hamamatsu_signal_295K_4_5OV}
\end{figure}

После запуска по производной в интервале от -1000 нс до 1000 нс считалось количество сигналов, превышавших порог.
Чтобы не считать один сигнал несколько раз, вводилось мертвое время 8 нс.
Если число сигналов в этом интервале было больше одного, то данный участок отбрасывался и брался следующий.
Это необходимо, чтобы сигнал был одиночным, т.е. был без примеси послеимпульсов.
Если же на интервале встречался один сигнал, то 

Затем вычислялся максимум на всем записанном отрезке и строился спектр амплитуд (рис.~\ref{image:recovery_time_ham_33_25C_amp}).
Для анализа выбирались лишь одноэлектронные импульсы, амплитуды которых расположены справа от порога.


\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{recovery_time_ham_33_25C_amp}}
\caption{Спектр амплитуд для Hamamatsu S10362-33-025C. Напряжение 73В, температура 295К.
Одноэлектронные импульсы имеют амплитуду, расположенную справа от порога.}
\label{image:recovery_time_ham_33_25C_amp}
\end{figure}

Далее, на записанном отрезке длиной 1 мкс вычислялось число событий, превышающих порог по производной.
Если на отрезке было более одного срабатывания, то этот участок отбрасывался.
Таким образом, после фильтрации должны остаться только одноэлектронные импульсы, не содержащие послеимпульсов.
На заключительном этапе производилось усреднение. Результат приведен на рис.~\ref{image:hamamatsu_signal_295K_73V}.


\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{hamamatsu_signal_295K_73V}}
\caption{Сигнал с Hamamatsu S10362-33-025C. Напряжение 73В, температура 295К.
Показан исходный сигнал и сигнал после усреднения. Для нахождения правильной формы импульса события рассматривались без послеимпульсов.}
\label{image:hamamatsu_signal_295K_73V}
\end{figure}

Чтобы определить амплитуду одноэлектронного импульса и время восстановления ячейки, была проведена аппроксимация полученного сигнала следующей функцией:

\begin{eqnarray}\label{eq:V(t)}
V(t) = - A \cdot \exp \left[- \frac{t - t_0}{\tau_{rec}} \right] \cdot \left( 1 - \exp \left[ -\frac{t - t_0}{\tau_{rise}} \right] \right) \cdot \theta(t - t_0) + V_0,
\end{eqnarray}

где $A$ - амплитуда импульса, $t_0$ - задержка по времени, $\tau_{rec}$ - искомое время восстановления ячейки,
$\tau_{rise}$ - время нарастания переднего фронта, $V_0$ - напряжение в отсутствии сигнала, $\theta(t - t_0)$ - функция Хевисайда.
Параметр $V_0$ вычислялся как среднее значение на участке длиной 80 нс, предшествующем появлению переднего фронта, и фиксировался при аппроксимации.
Другие параметры имели ограничения по максимальному и минимальному значению, но в довольно широких пределах.

Однако форма сигнала (рис.\ref{image:hamamatsu_signal_295K_73V}) имеет большое отклонение от зависимости (\ref{eq:V(t)}): $\chi^2 / Dof \approx 10$.
Это объясняется конечным временным разрешением системы, в результате чего на выходе системы сигнал будет представлять свертку с гауссовым распределением с дисперсией $\sigma^2$ :

\begin{eqnarray}\label{eq:V(t)}
V(t) = V_0 - \frac{A}{2} \cdot \Bigg( R_{fast} \cdot \left\{ F(\sigma, \tau_{rec}^{fast}) + F(\sigma, \tau_{total}^{fast}) \right\} + \\ \nonumber
R_{slow} \cdot \left\{ F(\sigma, \tau_{rec}^{slow}) + F(\sigma, \tau_{total}^{slow}) \right\}  \Bigg)
\end{eqnarray}

$$
F(\sigma, \tau) = \exp\left[ \frac{\sigma^2 - 2 t \cdot \tau}{2 \tau^2 } \right] \cdot \left( 1 + Erf \left[ \frac{t - \sigma^2 / \tau}{ \sigma \sqrt{2} } \right] \right)
$$

$$
\tau_{total}^{fast} = \frac{\tau_{rec}^{fast} \cdot \tau_{rise}}{\tau_{rec}^{fast} + \tau_{rise}}, \tau_{total}^{slow} = \frac{\tau_{rec}^{slow} \cdot \tau_{rise}}{\tau_{rec}^{slow} + \tau_{rise}}
$$


Более детальное исследование времени восстановления приведено в работе \cite{Determination of the recovery time of silicon photomultipliers}.
Температурные зависимости времени восстановления ячейки приведены в \cite{Temperature and Bias Voltage Dependence}.

\section{Темновые токи}

Для измерения темновых токов использовалась установка, аналогичная предыдущей (рис.~\ref{image:install_V_bd}), только без светодиода.
Запуск производился по внутреннему триггеру. Построив зависимость частоты срабатываний от величины порога, можно найти частоту темнового тока.
В данном случае будут учтены еще и послеимпульсы, но их можно вычесть в дальнейшем.
Сначала данные длиной 120 мкс записываются на компьютер. Потом вычисляется среднее значение базовой линии на участке, где не наблюдается сигнал.
Затем в программе вычисляется количество импульсов, больших по амплитуде, чем установленный порог. Начальное значение порога равно нулю и отсчитывается от базовой линии.
Конечное значение выбирается немногим больше максимально наблюдаемой амплитуды сигнала.
Итого, полученное количество импульсов делится на длину записанного участка в секундах (120 $мкс \cdot $число отрезков).
В результате получается так называемая "лестница" - график, показывающий частоту сигнала в зависимости от порога (рис.~\ref{image:dark_current_rate_ham_33_25C_295K_73.00V}).

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{dark_current_rate_ham_33_25C_295K_73V}}
\caption{График-лестница для Hamamatsu S10362-33-025C. Напряжение 73В, температура 295К.
Плато соответствует порогу в половину одноэлектронного импульса.}
\label{image:dark_current_rate_ham_33_25C_295K_73.00V}
\end{figure}


Штриховой линией обозначен уровень плато, где частота практически не зависит от порога.
Частота, соответствующая плато, является частотой темновых токов.
Сигналы, имеющие амплитуду меньше, чем уровень плато, являются шумами или послеимпульсами.
Сигналы, имеющие амплитуду больше, чем уровень плато, возникают уже из-за кросстоков.
Плато аппроксимируется константой и строится зависимость частоты от температуры.
Частота темновых токов пропорциональна плотности свободных носителей, которая выражается следующей формулой \cite{Characterization of SiPM: temperature dependencies}:

\begin{eqnarray}\label{eq:Hz_vs_temperature}
n(T) = A \cdot T^{3/2} \cdot \exp\left[ - \frac{E_g}{2 k_B \cdot T} \right],
\end{eqnarray}
где A - константа, зависящая от материала и технологических параметров, T - абсолютная температура, $E_g$ - ширина запрещенной зоны, $k_B$ - константа Больцмана.

Зависимость частоты от температуры была аппроксимирована функцией (\ref{eq:Hz_vs_temperature}). $\chi^2 / DoF < 1$, поэтому выбранная зависимость хорошо описывает данные.

\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{dark_current_rate_ham_33_25C_Hz_vs_temperature}}
\caption{Частота темновых токов в зависимости от температуры для Hamamatsu S10362-33-025C.
Данные аппроксимированы зависимостью (\ref{eq:Hz_vs_temperature}), причем $\chi^2 / DoF < 1$.}
\label{image:dark_current_rate_ham_33_25C_295K_73.00V}
\end{figure}




Также темновой ток зависит от перенапряжения при фиксированной температуре.
При низком перенапряжении ширина плато становится настолько малой, что определить частоту темновых токов становится невозможным.
Все зависимости были аппроксимированы экспоненциальной функцией, причем $\chi^2 / DoF \approx 1$, поэтому данная зависимость удовлетворительно описывает данные.

\begin{eqnarray}\label{eq:Hz_vs_overvoltage}
\nu(\Delta V, T = const) = B \cdot \exp[k_{\Delta V} \cdot \Delta V]
\end{eqnarray}

В других работах наблюдали как линейный рост частоты темновых токов от перенапряжения при фиксированной температуре
 \cite{Characterization and Simulation of the Response} и  \cite{After-pulsingandcross-talkinmulti-pixelphotoncounters}  , так и экспоненциальный \cite{Temperature and Bias Voltage Dependence}.

Зависимость частоты одновременно и от перенапряжения и от температуры можно записать следующим образом:

\begin{eqnarray}\label{eq:Hz_vs_overvoltage_temperature}
\nu(\Delta V, T) = C \cdot T^{3/2} \cdot \exp\left[ - \frac{E_g}{2 k_B \cdot T} + k_{\Delta V} \cdot \Delta V \right]
\end{eqnarray}

Константа $C$ не зависит ни от перенапряжения, ни от температуры.
Для того, чтобы найти значения $C, E_g, k_{\Delta V}$, все измерения частоты от температуры и перенапряжения были аппроксимированы функцией (\ref{eq:Hz_vs_overvoltage_temperature}).
В результате были восстановлены следующие значения:

$$ C = (1.76 \pm 0.41) \cdot 10^8 [Гц] $$
$$ E_g = 0.75 \pm 0.01 [эВ] $$
$$ k_{\Delta V} =  0.426 \pm 0.012 [1/В] $$

Точность аппроксимации двумерной функцией (\ref{eq:Hz_vs_overvoltage_temperature}) оказалась ниже ($\chi^2 / DoF = 160 / 67$),
 чем точность аппроксимации каждой из зависимостей (\ref{eq:Hz_vs_temperature}) или (\ref{eq:Hz_vs_overvoltage}), т.к. в этом случае параметры функции должны оставаться неизменными для всех измерений.


\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{dark_current_rate_ham_33_25C_Hz_vs_overvoltage}}
\caption{Зависимость частоты темновых токов от перенапряжения при фиксированной температуре для Hamamatsu S10362-33-025C.
Данные аппроксимированы экспоненциальной зависимостью (\ref{eq:Hz_vs_overvoltage}), причем $\chi^2 / DoF \approx 1$.}
\label{image:dark_current_rate_ham_33_25C_Hz_vs_overvoltage}
\end{figure}


\section{Кросстоки}

Существует несколько схожих вариантов измерения кросстока.
Первый заключается в использовании графика-лестницы.
При построении зависимости частоты появления сигналов от порога на графике можно наблюдать несколько участков,
на которых частота практически не зависит порога. Первое плато соответствует частоте темновых токов, которая обозначается $\nu_{0.5 p.e.}$.
Следующие наблюдаемые плато будут обусловлены наличием кросстоков. Частота второго плато обозначается $\nu_{1.5 p.e.}$, третьего - $\nu_{2.5 p.e.}$ и т.д.
Вероятность кросстока можно найти как отношение двух частот: $P_{X-talk} =  \nu_{1.5 p.e.} / \nu_{0.5 p.e.}$
Однако в нашем случае разрешение по амплитуде оказывается недостаточным, чтобы различить другие плато, кроме первого, поэтому данный метод не сработает.

Второй подход заключается в интегрировании сигнала за определенное время.
Если построить спектр накопленного заряда, то можно будет увидеть множество пиков.
Первый пик с центром в нуле - пьедестал, обусловленный интегрированием шумов.
Второй пик обусловлен одноэлектронным импульсом. Последующие пики возникают из-за наличия кросстоков.
Число событий в пиках обозначим $N_{i p.e}$, где i - номер пика, равный 1 для одноэлектронного.
Если найти отношение числа событий в пиках, вызванных кросстоком, к полному числу зарегистрированных полезных (не шумовых) событий,
то мы получим вероятность кросстока:

$$
P_{X-talk} = N_{i > 1 p.e} / ( N_{i > 1 p.e} + N_{1 p.e})
$$

Преимущество этого подхода заключается в хорошем разрешении по заряду, позволявшему четко разделять пики.
Недостаток же заключается во вкладе послеимпульсов в заряд, что приводит к искажению зарядового спектра и неоднозначному нахождению числа событий в одноэлектронном пике.

Третий, и наиболее правильный вариант измерений заключается в отбрасывании тех событий, которые содержат послеимпульсы.
Построив зависимость заряда сигнала от расстояния между ближайшими сигналами, можно наблюдать следующую картину...


\section{Послеимпульсы}

Схема измерения аналогична схеме измерения темновых токов и кросстока. Отличие состоит в обработке сигнала.
Если раньше сигнал обрабатывался в режиме on-line, то теперь данные сначала записываются на компьютер, а затем обрабатываются.
При записи использовался внутренний триггер. Уровень триггера выбирался примерно на уровне 50\% от величины одноэлектронного импульса.
Непрерывная длинна записи составила 120 мкс.



\section{Квантовая эффективность}

